# Graphical user interface (GUI) repository of the 2023 SenSwiss Team

**Table of content:**
- [Graphical user interface (GUI) repository of the 2023 SenSwiss Team](#graphical-user-interface-gui-repository-of-the-2023-senswiss-team)
- [Structure](#structure)
- [Installation](#installation)
- [Description](#description)
  - [Interface](#interface)
  - [Microfluidic system](#microfluidic-system)
  - [Camera](#camera)
  - [Spectrometer](#spectrometer)
  - [Arduino \& DC motor](#arduino--dc-motor)
  - [Signal processing](#signal-processing)
    - [Camera image](#camera-image)
    - [Spectrometer signal](#spectrometer-signal)
      - [Centroids](#centroids)
      - [Protocols](#protocols)
- [Usage](#usage)
- [Results](#results)
- [Authors](#authors)

<a id="Structure"></a>
## Structure
The GUI repository of the 2023 SenSwiss Team is organized as follows:
- `image_saved`: stores the images taken by the camera or the spectrographs taken by the spectrometer during the experiments.
- `layout_figures`: contains the figures used in the GUI
- `plots_saved`: stores the data plots generated by the GUI
- `protocols`: store the protocols used for the experiments, these protocols can be defined and directly loaded in the GUI
- **arduino_control.py**: contains the code to control the Arduino board
- **control_flir_camera.py**: contains the code to control the camera
- **gui.py**: contains the code of the GUI
- **imgproc.py**: contains the main functions to process the images taken by the camera and the spectrographs taken by the spectrometer
- **layout.py**: contains the code to define the layout of the GUI
- **microflu.py**: contains the code to control the microfluidic system

<a id="Installation"></a>
## Installation
To run the code, you will need to install several packages. The easiest way to do so is to use the Anaconda distribution. You can download it [here](https://www.anaconda.com/products/individual). Once Anaconda is installed, you can create a new environment and install the packages using the following commands in the Anaconda prompt:
```
conda create -n senswiss python=3.10
conda activate senswiss
```
Then, you can install the packages using the following commands:
```
pip install name_of_the_library
```

<a id="Description"></a>
## Description
This miniprogram allow the user to control the different systems of the sensor and to perform the experiments. The GUI can be used in two modes: with a camera or with a spectrometer, depending on which measurement is better suited for the experiment. The GUI will then automatically adapt the interface to the pluged in measurement device.

The GUI is divided into 3 parts:
- **Microfluidics** which controls the pump
- **Measurement device** which controls either the camera or the spectrometer depending on which is pluged in, and procresses the signal to obtain a signal over time
- **Motor control** which controls the DC motor to open or close the measurement chamber


<a id="Interface"></a>
### Interface
The GUI is presented as follows, with on the left, the image/spectrograph and the signal over time, and on the right, the control buttons and the parameters to set.

<a id="Microfluidic-system"></a>
### Microfluidic system

<a id="Camera"></a>
### Camera
GUI in camera mode:
![ROI in automatic mode](layout_figures/ROI_auto.jpg)

<a id="Spectrometer"></a>
### Spectrometer
GUI in spectrometer mode:
![ROI in automatic mode](layout_figures/GUI_general.jpg)



<a id="Arduino-&-DC-motor"></a>
### Arduino & DC motor


<a id="Signal-processing"></a>

# Signal processing

The GUI enables recognition of the device connected (camera/spectrometer) and is complete of functions specific to handle the modality chosen. 

## Camera image

The code enables the extraction of a Region Of Interest (ROI) from the camera image, facilitating saving and display in a separate window. It involves image filtering and thresholding, followed by moment calculations. Furthermore, the ROI can be tailored to various shapes like circles or rectangles.The average intensity is computed and returned.

The original idea was to use the intensity of the ROI to detect the concentration of the sample. However, this method was found to not be sensitive enough. Hence, we decided to rely on the wavelenght shift, measured through the spectrometer, to detect the concentration of the sample.

## Spectrometer signal

The spectrometer employed by the SenSwiss team 2023 is MAYA2000PR0. The spectrometer connected to the computer gets recognized and the signal is acquired. 

The signal from the spectrometer is low pass filtered. The dark and flat fields are saved (by pressing a button on the GUI), allowing to normalize the signal. The signal is then plotted in a top left window.
\usepackage[textwidth=8cm]{geometry}
\usepackage{amsmath}

$\text{normalized\_intensities\_spec} = \frac{\test{intensities\_spec} - \text{dark\_field}}{\text{flat\_field} - \text{dark\_field}}  \text{normalize\_gain}$

The peaks are computed and the wavelength shift is calculated. The shift of the absorption peak is then displayed in the bottom left window of the GUI.

As a good Signal-to-Noise ratio is crucial for optimal detection, different  denoising methods have been implemented.

Firstly, we implemented a simple moving average filter. The filter is applied to the signal and the result is plotted in a top right window. This denoising method proved not to be effective enough. Hence a Savitzy-Golay filter was added to smooth the intensities signal before normalizing. The window can be chosen by the user. The result is plotted in a bottom left window.

### Centroids

Having found the previous method ineffective, we resorted to computing centroids. This involves calculating a moving average for centroids and then plotting either centroids or wavelength data over time. Vertical lines are incorporated at the times of comments, enhancing its utility as a tool for visualizing data and comment annotations. The code for this can be found in the file `plotCentroids.py`.




<a id="Protocols"></a>
### Protocols

<a id="Usage"></a>
## Usage
To run the GUI, you can use the following command in the Anaconda prompt after activating the environment:
```
python gui.py
```
Be sure to check that the necessary devices (camera/spectrometer, pump, arduino) are connected to the computer before running the GUI.

<a id="Results"></a>
## Results


The initial plan involved fitting the segments of the signal with an exponential function after applying GFAP. The intention was to save the parameters of the exponential function for each segment and utilize them to train a Machine Learning model for predicting the concentration of the sample under examination. This approach required a substantial amount of data to be collected. Unfortunately, due to the challenges faced by the SenSwiss team in 2023, this data collection could not be accomplished. Nevertheless, the functions for fitting the exponential functions are stored in 'imgproc.py' and remain available for use by future teams.

The classification of each sample (from Very Low to Very High Concentration) was hence computed by fitting two linear regression curves. 


<a id="Authors"></a>
## Authors
- [**Marin Bricq**](https://github.com/MBricq)
- [**Arthur Eglin**](https://github.com/ArthurEglin)
- [**Elena Gado**](https://github.com/ElenaGrazia)